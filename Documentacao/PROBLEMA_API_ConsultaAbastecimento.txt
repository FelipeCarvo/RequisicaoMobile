====================================================================
PROBLEMA IDENTIFICADO - API ConsultaAbastecimento (26/12/2025)
====================================================================

RESUMO DO PROBLEMA:
A API /api/frotas/Abastecimentos/ConsultaAbastecimento retorna dados PARCIAIS
quando consultada, faltando IDs (GUIDs) essenciais para preencher o formul√°rio
de edi√ß√£o corretamente.

====================================================================
EVID√äNCIAS (Logs do Console)
====================================================================

Ao clicar em "Ver Detalhes" de um abastecimento, a API retorna:

‚úÖ CAMPOS QUE V√äM DA API:
- emprdCod: 100 (c√≥digo num√©rico do empreendimento)
- emprDesc: "CONDOMIO EDIFICIO MODELO"
- codEquipamento: "RE01"
- modelo: "RETROESCAVADEIRA"
- quantidade: 777
- fornecedorId: "62741214-a57a-49af-9851-dd759d29b549" (GUID ‚úì)
- equipamentoId: "802792e5-9c95-4a27-b98c-eab39b6003d6" (GUID ‚úì)
- insumoId: "8bb13450-ff35-4d10-bb40-d61019b45126" (GUID ‚úì)
- entidade: 1 (c√≥digo num√©rico da empresa)

‚ùå CAMPOS QUE N√ÉO V√äM DA API:
- empresaId (GUID) - s√≥ vem "entidade: 1" (c√≥digo num√©rico)
- empreendimentoId (GUID) - s√≥ vem "emprdCod: 100" (c√≥digo num√©rico)
- etapaId (GUID)
- blocoId (GUID)
- centroDespesaId (GUID)

====================================================================
IMPACTO NO FORMUL√ÅRIO DE EDI√á√ÉO
====================================================================

Campos que ficam VAZIOS ao abrir "Ver Detalhes":
1. ‚ùå Empresa - campo fica vazio (n√£o consegue resolver o GUID a partir do c√≥digo num√©rico)
2. ‚ùå Centro de Despesas - campo fica vazio
3. ‚ùå Etapa - campo fica vazio
4. ‚ùå Bloco - campo fica vazio

Campos que FUNCIONAM:
1. ‚úÖ Fornecedor - vem o GUID correto
2. ‚úÖ Equipamento - vem o GUID correto
3. ‚úÖ Insumo - vem o GUID correto
4. ‚úÖ Empreendimento - consegue resolver o GUID a partir do c√≥digo num√©rico

====================================================================
CAUSA RAIZ
====================================================================

A API de CONSULTA (/api/frotas/Abastecimentos/ConsultaAbastecimento)
retorna apenas:
- IDs completos: fornecedorId, equipamentoId, insumoId
- C√≥digos num√©ricos: emprdCod, entidade
- Descri√ß√µes: emprDesc, codEquipamento, modelo

A API de GRAVA√á√ÉO (/api/frotas/Abastecimentos/GravaAbastecimento)
EXIGE os seguintes GUIDs:
- IdEmpresa (GUID)
- IdEmprd (GUID)
- IdCentroDespesa (GUID)
- IdEtapa (GUID)
- IdBloco (GUID)

Ou seja: INCOMPATIBILIDADE entre o que a API de consulta retorna e
o que a API de grava√ß√£o exige.

====================================================================
DOCUMENTA√á√ÉO DA API (Frt_ApiFrotas.md)
====================================================================

Segundo a documenta√ß√£o (se√ß√£o 1.2 - ConsultaAbastecimento), o retorno
esperado √©:

```json
{
  "emprdCod": 0,
  "emprDesc": "string",
  "codEquipamento": "string",
  "modelo": "string",
  "quantidade": 0,
  "valorTotal": 0,
  "entidade": 0,               // ‚ùå C√≥digo num√©rico, n√£o GUID
  "insumoCdg": "string",
  "insumoDesc": "string",
  "dataAbastecimento": "2025-10-20T16:36:26.777Z",
  "identificador": "string",
  "localAbastecimento": "string",
  "responsavelCod": "string",
  "responsavelNome": "string",
  "placa": "string",
  "odometro": 0,
  "numVoucher": 0,
  "numRetornoPosto": 0,
  "numeroCartao": "string",
  "horimetro": 0,
  "fornecedorRazao": "string",
  "tpAbastecimento": 0,
  "codAbastecimentoExterno": "string",
  "abastecimentoId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "dataCadastro": "2025-10-20T16:36:26.777Z",
  "equipamentoId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "insumoId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "comboioBombaCdg": "string",
  "comboioBombaDescr": "string",
  "comboioBombaId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "bicoCdg": 0,
  "bicoDescr": "string",
  "bicoId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "fornecedorId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "responsavelId": "3fa85f64-5717-4562-b3fc-2c963f66afa6"
}
```

CONFIRMADO: A documenta√ß√£o N√ÉO inclui os campos necess√°rios:
- empresaId / entidadeId ‚ùå
- empreendimentoId / emprdId ‚ùå
- etapaId ‚ùå
- blocoId ‚ùå
- centroDespesaId / planoContasDespesaId ‚ùå

====================================================================
SOLU√á√ïES POSS√çVEIS
====================================================================

SOLU√á√ÉO 1: BACKEND - Adicionar campos na API de Consulta (RECOMENDADO)
-----------------------------------------------------------------------
Pedir para o backend adicionar os seguintes campos no retorno de
/api/frotas/Abastecimentos/ConsultaAbastecimento:

+ "empresaId": "GUID",                    // ID da empresa
+ "empreendimentoId": "GUID",             // ID do empreendimento
+ "etapaId": "GUID",                      // ID da etapa
+ "blocoId": "GUID",                      // ID do bloco
+ "centroDespesaId": "GUID",              // ID do centro de despesas
+ "planoContasDespesaId": "GUID"          // Alternativa para centro

Isso permitiria que o formul√°rio de edi√ß√£o carregasse TODOS os campos
corretamente.

SOLU√á√ÉO 2: FRONTEND - Permitir sele√ß√£o manual dos campos faltantes
-------------------------------------------------------------------
Manter o c√≥digo atual que:
1. Carrega o que vier da API
2. Deixa campos vazios quando os IDs n√£o vierem
3. Permite que o usu√°rio selecione manualmente:
   - Empresa
   - Centro de Despesas
   - Etapa
   - Bloco

‚ö†Ô∏è PROBLEMA: O usu√°rio perde informa√ß√£o ao editar. N√£o sabe quais eram
os valores originais desses campos.

SOLU√á√ÉO 3: FRONTEND - Buscar IDs via lookups reversos
------------------------------------------------------
Tentar resolver os GUIDs a partir dos c√≥digos/descri√ß√µes:
- entidade: 1 ‚Üí buscar empresaId no lookup de empresas
- emprdCod: 100 ‚Üí buscar empreendimentoId no lookup (J√Å IMPLEMENTADO ‚úì)

‚ö†Ô∏è LIMITA√á√ÉO: N√£o funciona para etapa, bloco e centro de despesas
porque n√£o temos c√≥digos/descri√ß√µes para fazer a busca reversa.

====================================================================
SOLU√á√ÉO IMPLEMENTADA (26/12/2025)
====================================================================

Foi implementado:
1. ‚úÖ Logs detalhados para identificar campos faltantes
2. ‚úÖ Resolu√ß√£o de empreendimentoId a partir de emprdCod (lookup reverso)
3. ‚úÖ Resolu√ß√£o de empresaId a partir de entidade (c√≥digo num√©rico)
4. ‚úÖ Carregamento de listas para permitir sele√ß√£o manual dos campos vazios
5. ‚úÖ Mensagens de debug claras indicando quais campos n√£o vieram da API

Campos que o usu√°rio precisa selecionar manualmente ao editar:
- Centro de Despesas
- Etapa
- Bloco

====================================================================
RECOMENDA√á√ÉO FINAL
====================================================================

**SOLU√á√ÉO 1 (Backend)** √© a mais adequada porque:
- Mant√©m a integridade dos dados
- Usu√°rio v√™ exatamente como o abastecimento foi gravado
- Evita perda de informa√ß√£o na edi√ß√£o
- Segue o princ√≠pio REST: API de consulta deve retornar todos os dados
  necess√°rios para reproduzir o estado completo do recurso

**PR√ìXIMO PASSO:**
Solicitar ao time de backend a inclus√£o dos campos faltantes na API
ConsultaAbastecimento, especialmente para TpAbastecimento = 1 (Postos).

====================================================================
LOGS DE EVID√äNCIA (Console)
====================================================================

üìã [EDICAO] Campos importantes: {
  empresaId: undefined,           // ‚ùå
  centroDespesaId: undefined,     // ‚ùå
  etapaId: undefined,             // ‚ùå
  blocoId: undefined,             // ‚ùå
  empreendimentoId: undefined,    // ‚ùå
  emprdCod: 100,                  // ‚úÖ
  entidade: 1                     // ‚úÖ
}

‚ö†Ô∏è [PREENCHER] Etapa n√£o encontrada nos dados
‚ö†Ô∏è [PREENCHER] Bloco n√£o encontrado nos dados
‚ö†Ô∏è [PREENCHER] Centro de Despesas n√£o encontrado nos dados

‚úÖ [PREENCHER] Preenchimento conclu√≠do. Estado atual: {
  fornecedor: '62741214-a57a-49af-9851-dd759d29b549',
  equipamento: '802792e5-9c95-4a27-b98c-eab39b6003d6',
  empresa: 1,                      // ‚ö†Ô∏è C√≥digo num√©rico, n√£o GUID
  empreendimento: '8ff60057-89c9-4e76-92e6-b119d4d891b6', // ‚úÖ Resolvido
  centroDespesas: null,            // ‚ùå
  etapa: null,                     // ‚ùå
  bloco: null,                     // ‚ùå
  insumo: '8bb13450-ff35-4d10-bb40-d61019b45126'
}
